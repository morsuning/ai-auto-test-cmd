# API 自动化测试命令行工具需求规格说明书

## 1. 项目概述

本项目旨在实现一个API自动化测试命令行工具，用于简化API测试流程，提高测试效率。该工具支持通过Dify Workflow API生成测试用例，也支持本地生成测试用例，并能批量执行测试请求。

## 2. 功能需求

### 2.1 测试用例生成功能

#### 2.1.1 通过Dify API生成测试用例

可通过命令和参数访问Dify Workflow API，生成API测试用例并保存为本地CSV文件。

**可附加的参数包括：**
- 目标URL：指定Dify API的访问地址
- 请求参数格式：支持XML或JSON格式
- 请求参数：提供正例报文
- 生成用例数量：指定需要生成的测试用例数量
- 接口文档（可选）：提供接口文档以辅助生成更准确的测试用例

**交互要求：**
- 执行时间可能较长，需提供友好的进度提示
- 可能出现失败情况，需提供清晰的错误信息
- 支持直接返回或文档方式返回生成的测试用例

**使用示例：**

```shell
# 根据正例xml报文生成10条测试用例
atc gen -u https://xxx.dify.com/xxx/xxx -xml -raw "xxxx" -n 10

# 根据正例json报文生成20条测试用例
atc gen -u https://xxx.dify.com/xxx/xxx -json -raw "xxxx" -n 20

# （可选）根据正例xml报文和接口文档生成5条正例报文
atc gen -u https://xxx.dify.com/xxx/xxx -xml -raw "xxxx" -n 5 -d xxx.xlsx -p
```

#### 2.1.2 本地生成测试用例

可以在不调用Dify API的情况下随机生成测试用例，用户只需提供正向用例XML或JSON报文。

**生成规则：**
- 根据正向用例值域上下浮动50%自动生成测试数据
  - 对于数字类型：值会在原始值的±50%范围内随机浮动
  - 对于字符串类型：长度保持不变，但会随机替换1-3个字符为随机字母
  - 对于布尔类型：有50%的概率会翻转值
  - 对于数组类型：每个元素都会按照上述规则进行随机变化
  - 对于嵌套对象：递归应用上述规则到每个字段
- 用户可以指定生成用例的数量
- 支持将生成的测试用例保存为CSV文件，便于后续使用

**使用示例：**

```shell
# 本地根据正例xml报文生成10条测试用例
atc local-gen -xml -raw "xxxx" -n 10

# 本地根据正例json报文生成15条测试用例
atc local-gen -json -raw "xxxx" -n 15

# 本地根据正例json报文生成5条测试用例并保存到指定文件
atc local-gen -json -raw "xxxx" -n 5 -o test_data.csv
```

**数据处理能力：**
- 智能解析XML和JSON格式，支持复杂的嵌套结构
- 自动识别数据类型（数字、字符串、布尔值等）并应用相应的随机化规则
- 保留原始数据的结构和关系，只修改值

### 2.2 测试执行功能

可通过命令及本地的CSV文件，批量请求目标系统接口，返回执行结果，并且可以保存。

**功能特点：**
- 支持POST和GET等HTTP方法
- 支持直接在命令行显示结果
- 支持将结果保存到指定文件

**使用示例：**

```shell
# 根据测试用例文件xxx.csv,批量使用POST方法请求目标系统http接口，发送JSON格式数据
atc request -u https://xxx.system.com/xxx/xxx -m post -f xxx.csv --json

# 根据测试用例文件xxx.csv,批量使用POST方法请求目标系统http接口，发送XML格式数据
atc request -u https://xxx.system.com/xxx/xxx -m post -f xxx.csv --xml

# 根据测试用例文件xxx.csv,批量使用GET方法请求目标系统http接口，结果默认保存至当前目录
atc request -u https://xxx.system.com/xxx/xxx -m get -f xxx.csv --json -s

# 根据测试用例文件xxx.csv,批量使用GET方法请求目标系统http接口，结果保存至指定目录及文件
atc request -u https://xxx.system.com/xxx/xxx -m get -f xxx.csv --json -s /xxx/tool/result.csv
```

**实现特性：**
- 支持从CSV文件读取测试数据，自动解析为测试用例
- 支持POST和GET请求方法
- 支持多种请求体格式：JSON和XML（必须明确指定格式）
- 强制要求用户选择请求体格式（--json 或 --xml），避免默认行为的歧义
- 支持并发请求以提高执行效率
- 支持自定义超时时间
- 智能数据类型解析（数字、布尔值、JSON等）
- 详细的执行结果显示，包括状态码、响应时间等
- 支持将测试结果保存为CSV文件
- 提供完整的统计信息（总数、成功数、失败数、成功率等）

## 3. 技术要求

### 3.1 开发环境

- 编程语言：Go
- 命令行框架：Cobra

### 3.2 性能要求

- 支持并发请求以提高测试效率
- 内存占用合理，避免大量数据导致内存溢出

### 3.3 可用性要求

- 命令行参数设计符合直觉，易于记忆
- 提供详细的帮助信息
- 错误信息清晰明确

## 4. 交付物

- 源代码
- 使用说明文档
- 可执行文件（支持多平台）
  - Windows x86
  - macOS ARM
  - Linux ARM
  - Linux x86
- 构建脚本（支持交叉编译）

## 5. 项目计划

- 需求分析与设计：[待定]
- 开发实现：[待定]
- 测试验证：[待定]
- 交付上线：[待定]